name: remote ssh command
on: [push]
jobs:

  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
    - name: executing remote ssh commands using password
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        password: ${{ secrets.PASSWORD }}
        script: |
            cd /root/JD-analysis-wechat-serverside
            # 杀死已有进程
            #kill -9 $(ps aux|grep wechat-serverside-0.0.1-SNAPSHOT.jar)
            # 切换目录
            cd /root/JD-analysis-wechat-serverside &&
            # 从GitHub仓库拉取最新分支
            git pull &&
            # 清理项目
            mvn clean &&
            # 安装项目
            mvn install -Dmaven.test.skip=true &&
            # 运行项目
            cd target &&
            nohup java -jar wechat-serverside-0.0.1-SNAPSHOT.jar &
